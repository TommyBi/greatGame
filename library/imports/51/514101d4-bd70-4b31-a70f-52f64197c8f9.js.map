{"version":3,"sources":["assets/src/framework/ui/BasePanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ComponentHelper from \"../tools/ComponentHelper\";\r\nimport Handler from \"../base/Handler\";\r\nimport LoaderManager from \"../manager/LoaderManager\";\r\nimport GamePoolManager from \"../manager/GamePoolManager\";\r\nimport UIMananger from \"../manager/UIMananger\";\r\nimport { UIState, StateType } from \"./UIState\";\r\nimport EventDispath from \"../message/EventDispath\";\r\nimport SDKManager from \"../manager/SDKManager\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BasePanel extends cc.Component {\r\n\r\n    public uiName: string = \"basePanel\";\r\n    //点击面板其他位置是否关不面板 需要在prefab中设置node的size大小\r\n    public maskURL: string = \"mbg\";//资源放在common模块中\r\n    private _ismask: boolean = true;\r\n    public effect: any = null;\r\n    public clickOtherClose: boolean = false;\r\n    public moduleName: string;\r\n    public inData: any;\r\n    private modelUI: cc.Node;//背景\r\n    private uiState: UIState;\r\n    closeBack: Function = null;\r\n    isVideoClose = false;\r\n    init(clickClose) {\r\n        if (this._ismask) {\r\n            this._initModule();\r\n        }\r\n        this.clickOtherClose = clickClose;\r\n    }\r\n\r\n    setUIName(name) {\r\n        this.uiName = name;\r\n    }\r\n\r\n    setModuleName(mname) {\r\n        this.moduleName = mname;\r\n    }\r\n\r\n    setClickClose(value) {\r\n        this.clickOtherClose = value;\r\n    }\r\n\r\n    setEffect(value) {\r\n        this.effect = value;\r\n    }\r\n\r\n    /**\r\n     * 设置ui状态\r\n     */\r\n    setUIState(state) {\r\n        this.uiState = state;\r\n        this.uiState.ui = this;\r\n    }\r\n\r\n\r\n    private upDateState(state: StateType) {\r\n        if (!!this.uiState) {\r\n            this.uiState.openState = state;\r\n            if (state === StateType.close) {\r\n                this.uiState.reset();\r\n            }\r\n        }\r\n    }\r\n\r\n    //打开面板前 先执行的函数\r\n    _show_(closeBack, args) {\r\n        this.inData = args;\r\n        this.closeBack = closeBack;\r\n        this.upDateState(StateType.opening);\r\n    }\r\n\r\n    /**\r\n     * 是否能立即关闭，主要用于有些面板不能立马关闭，需要等条件完成才能，例如转盘\r\n     */\r\n    canHideNow() {\r\n        return true;\r\n    }\r\n\r\n    startHide() {\r\n        // if (this.isVideoClose) SDKManager.reportTrigger();\r\n    }\r\n\r\n    startShow() {\r\n\r\n    }\r\n\r\n    _hide_() {\r\n        // if (LoaderManager.isRelease(this.moduleName)) {\r\n        //     this.node.destroy();\r\n        //     GamePoolManager.clearByTarget(this); \r\n        //     this._destroyClear(); \r\n        // } else {\r\n        //     GamePoolManager.putBackByTarget(this);\r\n        //     if (!!this.node.parent) {\r\n        //         this.node.removeFromParent(false);\r\n        //     }\r\n        //     this._closeClear();\r\n        // }\r\n        this._hideModeule();\r\n        this.upDateState(StateType.close);\r\n        this.node.destroy();\r\n    }\r\n\r\n    //关时清理\r\n    private _closeClear() {\r\n\r\n    }\r\n\r\n    //销毁时清理\r\n    private _destroyClear() {\r\n\r\n    }\r\n\r\n    //设置ui的父容器\r\n    setUIParent(parent) {\r\n        if (cc.isValid(parent)) {\r\n            this.node.parent = parent;\r\n        }\r\n    }\r\n\r\n    //打开时调用\r\n    on_Show(args) {\r\n        this._showModuleAction();\r\n        this.upDateState(StateType.open);\r\n    }\r\n\r\n    on_Hide() {\r\n        this._hideModeule();\r\n    }\r\n\r\n    close() {\r\n        if (this.closeBack) this.closeBack();\r\n        EventDispath.removeEventListeners(this);\r\n        UIMananger.hidePanel(this.uiName);\r\n    }\r\n    close1() {\r\n        this.closeBack = null;\r\n        EventDispath.removeEventListeners(this);\r\n        UIMananger.hidePanel(this.uiName);\r\n    }\r\n\r\n    //初始化模态\r\n    private _initModule() {\r\n        if (!cc.isValid(this.modelUI)) {\r\n            this.modelUI = ComponentHelper.createSprite(null, null);\r\n            LoaderManager.loaderSpriteFrame(this.maskURL, Handler.create(this._moduleComplete, this), 'commonRes');\r\n            this.modelUI.addComponent(cc.BlockInputEvents);\r\n            this.modelUI.opacity = 0;\r\n            this.modelUI.parent = this.node;\r\n            this.modelUI.setSiblingIndex(0);\r\n        }\r\n\r\n    }\r\n\r\n    private _moduleComplete(res) {\r\n        let sprite: cc.Sprite = ComponentHelper.spriteFrame(this.modelUI, res);\r\n        sprite.trim = false;\r\n        sprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;\r\n        let msize = cc.view.getVisibleSize();\r\n        this.modelUI.width = msize.width;\r\n        this.modelUI.height = msize.height;\r\n        this._clickClose();\r\n    }\r\n\r\n    //模态效果\r\n    private _showModuleAction() {\r\n        if (cc.isValid(this.modelUI)) {\r\n            this.modelUI.stopAllActions();\r\n            this.modelUI.opacity = 170;\r\n            // this.modelUI.runAction(cc.fadeTo(0.2, 170));\r\n        }\r\n    }\r\n\r\n    private _hideModeule() {\r\n        if (cc.isValid(this.modelUI)) {\r\n            this.modelUI.stopAllActions();\r\n            this.modelUI.opacity = 0;\r\n        }\r\n    }\r\n\r\n    //点击空白区域关闭\r\n    _clickClose() {\r\n        this.modelUI.on('touchend', (event) => {\r\n            event.stopPropagation();\r\n            if (this.clickOtherClose) {\r\n                let clickPos = event.getLocation();\r\n                let visibleSize = cc.view.getVisibleSize();\r\n                clickPos.x = clickPos.x - visibleSize.width / 2;\r\n                clickPos.y = clickPos.y - visibleSize.height / 2;\r\n                let rect = this.node.getBoundingBox();\r\n                if (!rect.contains(clickPos)) {\r\n                    this.close();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n"]}