{"version":3,"sources":["assets/src/framework/ui/BasePanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ComponentHelper from \"../tools/ComponentHelper\";\nimport Handler from \"../base/Handler\";\nimport LoaderManager from \"../manager/LoaderManager\";\nimport GamePoolManager from \"../manager/GamePoolManager\";\nimport UIMananger from \"../manager/UIMananger\";\nimport { UIState, StateType } from \"./UIState\";\nimport EventDispath from \"../message/EventDispath\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class BasePanel extends cc.Component {\n\n    public uiName: string = \"basePanel\";\n    //点击面板其他位置是否关不面板 需要在prefab中设置node的size大小\n    public maskURL: string = \"mbg\";//资源放在common模块中\n    private _ismask: boolean = true;\n    public effect: any = null;\n    public clickOtherClose: boolean = false;\n    public moduleName: string;\n    public inData: any;\n    private modelUI: cc.Node;//背景\n    private uiState: UIState;\n    init(clickClose) {\n        if (this._ismask) {\n            this._initModule();\n        }\n        this.clickOtherClose = clickClose;\n    }\n\n    setUIName(name) {\n        this.uiName = name;\n    }\n\n    setModuleName(mname) {\n        this.moduleName = mname;\n    }\n\n    setClickClose(value) {\n        this.clickOtherClose = value;\n    }\n\n    setEffect(value) {\n        this.effect = value;\n    }\n\n    /**\n     * 设置ui状态\n     */\n    setUIState(state) {\n        this.uiState = state;\n        this.uiState.ui = this;\n    }\n\n\n    private upDateState(state: StateType) {\n        if (!!this.uiState) {\n            this.uiState.openState = state;\n            if (state === StateType.close) {\n                this.uiState.reset();\n            }\n        }\n    }\n\n    //打开面板前 先执行的函数\n    _show_(args) {\n        this.inData = args;\n        this.upDateState(StateType.opening);\n    }\n\n    /**\n     * 是否能立即关闭，主要用于有些面板不能立马关闭，需要等条件完成才能，例如转盘\n     */\n    canHideNow() {\n        return true;\n    }\n\n    startHide() {\n\n    }\n\n    startShow() {\n\n    }\n\n    _hide_() {\n        this._hideModeule();\n        this.upDateState(StateType.close);\n        this.node.destroy();\n    }\n\n    //关时清理\n    private _closeClear() {\n\n    }\n\n    //销毁时清理\n    private _destroyClear() {\n\n    }\n\n    //设置ui的父容器\n    setUIParent(parent) {\n        if (cc.isValid(parent)) {\n            this.node.parent = parent;\n        }\n    }\n\n    //打开时调用\n    on_Show(args) {\n        this._showModuleAction();\n        this.upDateState(StateType.open);\n    }\n\n    on_Hide() {\n        this._hideModeule();\n    }\n\n    close() {\n        EventDispath.removeEventListeners(this);\n        UIMananger.hidePanel(this.uiName);\n    }\n\n    //初始化模态\n    private _initModule() {\n        if (!cc.isValid(this.modelUI)) {\n            this.modelUI = ComponentHelper.createSprite(null, null);\n            LoaderManager.loaderSpriteFrame(this.maskURL, Handler.create(this._moduleComplete, this), 'commonRes');\n            this.modelUI.addComponent(cc.BlockInputEvents);\n            this.modelUI.opacity = 0;\n            this.modelUI.parent = this.node;\n            this.modelUI.setSiblingIndex(0);\n        }\n\n    }\n\n    private _moduleComplete(res) {\n        let sprite: cc.Sprite = ComponentHelper.spriteFrame(this.modelUI, res);\n        sprite.trim = false;\n        sprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;\n        let msize = cc.view.getVisibleSize();\n        this.modelUI.width = msize.width;\n        this.modelUI.height = msize.height;\n        this._clickClose();\n    }\n\n    //模态效果\n    private _showModuleAction() {\n        if (cc.isValid(this.modelUI)) {\n            this.modelUI.stopAllActions();\n            this.modelUI.opacity = 0;\n            this.modelUI.runAction(cc.fadeTo(0.2, 150));\n        }\n    }\n\n    private _hideModeule() {\n        if (cc.isValid(this.modelUI)) {\n            this.modelUI.stopAllActions();\n            this.modelUI.opacity = 0;\n        }\n    }\n\n    //点击空白区域关闭\n    _clickClose() {\n        this.modelUI.on('touchend', (event) => {\n            event.stopPropagation();\n            if (this.clickOtherClose) {\n                let clickPos = event.getLocation();\n                let visibleSize = cc.view.getVisibleSize();\n                clickPos.x = clickPos.x - visibleSize.width / 2;\n                clickPos.y = clickPos.y - visibleSize.height / 2;\n                let rect = this.node.getBoundingBox();\n                if (!rect.contains(clickPos)) {\n                    this.close();\n                }\n            }\n        });\n    }\n\n}\n"]}