{"version":3,"sources":["assets/src/game/view/order/OrderView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport SDKManager from \"../../../framework/manager/SDKManager\";\r\nimport { UIEffectType } from \"../../../framework/manager/UIEffectManager\";\r\nimport UIMananger from \"../../../framework/manager/UIMananger\";\r\nimport EventDispath from \"../../../framework/message/EventDispath\";\r\nimport { EventType } from \"../../../framework/message/EventType\";\r\nimport MKUtils from \"../../../framework/tools/MkUtils\";\r\nimport SortUtils from \"../../../framework/tools/SortUtils\";\r\nimport Utils from \"../../../framework/tools/Utils\";\r\nimport BasePanel from \"../../../framework/ui/BasePanel\";\r\nimport UIType from \"../../consts/UIType\";\r\nimport PlayerModel from \"../../datas/PlayerModel\";\r\nimport ConfigManager from \"../../manager/ConfigManager\";\r\nimport { PopType } from \"../popView/PopView1\";\r\nimport AVirtualScrollView from \"../task/AVirtualScrollView\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n/**\r\n * 订单中心\r\n * TODO:\r\n */\r\n@ccclass\r\nexport default class OrderView extends BasePanel {\r\n\r\n    @property(cc.Node)\r\n    btn_close: cc.Node = null;\r\n    @property(cc.Node)\r\n    btn_quality: cc.Node = null;\r\n    @property(cc.Node)\r\n    btn_update: cc.Node = null;\r\n    @property(cc.Label)\r\n    xfzsLb: cc.Label = null;\r\n\r\n    @property(AVirtualScrollView)\r\n    scroller: AVirtualScrollView = null;\r\n\r\n    scrollerData = [];\r\n    onEnable(): void {\r\n        // 退出\r\n        EventDispath.on(this.btn_close, this.onBtnCloseHandle, this);\r\n\r\n        EventDispath.on(this.btn_quality, this.onQuality, this);\r\n        EventDispath.on(this.btn_update, this.onUpdate, this);\r\n\r\n        EventDispath.addEventListener(EventType.ORDER_CLOSE, this.onBtnCloseHandle, this);\r\n        EventDispath.addEventListener(EventType.ORDER_UPDATE_INDEX, this.updateData, this);\r\n        EventDispath.addEventListener(EventType.ORDER_UPDATE_LIST, this.completeUpate, this);\r\n        EventDispath.addEventListener(EventType.ORDER_GIVE_UP, this.onGiveUp, this);\r\n        EventDispath.addEventListener(EventType.ORDER_UNLOCK, this.onUnlock, this);\r\n        EventDispath.addEventListener(EventType.GUIDE_COMPLETE, this.guidComplete, this);\r\n      \r\n        let list = PlayerModel.getOrderList();\r\n        this.scrollerData = list;\r\n        this.initUI();\r\n\r\n    }\r\n    protected onLoad(): void {\r\n\r\n    }\r\n    protected start(): void {\r\n    }\r\n    on_Show(args: any): void {\r\n        if (PlayerModel.guideStep >= 0) {\r\n            this.scroller.vertical = false;\r\n            MKUtils.setNodeDelay(this.node, 0.5, () => {\r\n                EventDispath.send(EventType.GUIDE_UPDATE)\r\n                \r\n            })\r\n        }\r\n        // MKUtils.setNodeDelay(this.node, 0.1, this.initUI.bind(this))\r\n        // this.initUI();\r\n        super.on_Show(args);\r\n    }\r\n\r\n    startShow() {\r\n    }\r\n    //放弃订单\r\n    onGiveUp() {\r\n        PlayerModel.orderVideoNum = 0;\r\n        // this.scrollerData[0] = ConfigManager.getOrder();\r\n        this.initUI();\r\n    }\r\n    //订单奖励领取后更新列表\r\n    completeUpate() {\r\n        this.scrollerData[0] = ConfigManager.getOrder();\r\n        this.initUI();\r\n    }\r\n    //刷新订单列表\r\n    updateList() {\r\n        MKUtils.alertTips(\"刷新订单成功\")\r\n        EventDispath.removeByEvent(EventType.VIDEO_BACK, this.updateList, this);\r\n        for (let i = 0; i < this.scrollerData.length; i++) {\r\n            let item = this.scrollerData[i];\r\n            if (!item.state && item.unlock) {\r\n                this.scrollerData[i] = ConfigManager.getOrder();\r\n            }\r\n        }\r\n        this.initUI();\r\n    }\r\n    onUnlock() {\r\n        this.scroller.scrollToTop();\r\n        let list = PlayerModel.getOrderList();\r\n        let indexList = [];\r\n        let arr = list.filter((value, index) => {\r\n            if (value.unlock == 0) indexList.push(index);\r\n            return value.unlock == 0;\r\n        })\r\n        list[indexList[0]] = ConfigManager.getOrder();\r\n        PlayerModel.orderLen++;\r\n\r\n        this.scrollerData = PlayerModel.getOrderList();;\r\n        this.initUI();\r\n        this.scroller.scrollToTop();\r\n    }\r\n    updateData(index) {\r\n        this.scrollerData[index] = ConfigManager.getOrder();\r\n        this.initUI();\r\n    }\r\n    initUI() {\r\n        for (let i = 0; i < this.scrollerData.length; i++) {\r\n            let item = this.scrollerData[i];\r\n            let lastTime = item.time - Math.floor(Utils.returnTime() / 1000);\r\n            if (lastTime <= 0 && !item.state) {\r\n                this.scrollerData[i] = ConfigManager.getOrder();\r\n            }\r\n        }\r\n\r\n        this.scroller.refreshData(this.scrollerData);\r\n        this.scroller.scrollToTop();\r\n        this.scroller.node.active = false;\r\n        MKUtils.setNodeDelay(this.node, 0.1, () => {\r\n            this.scroller.node.active = true;\r\n        })\r\n        this.xfzsLb.string = PlayerModel.getXfzs() + \"\";\r\n\r\n    }\r\n\r\n    onQuality() {\r\n        UIMananger.showPanel(UIType.orderQualityView);\r\n    }\r\n    //刷新订单\r\n    onUpdate() {\r\n        EventDispath.addEventListener(EventType.VIDEO_BACK, this.updateList, this);\r\n        UIMananger.showPanel(UIType.popView1, null, () => {\r\n            EventDispath.removeByEvent(EventType.VIDEO_BACK, this.updateList, this);\r\n        }, UIEffectType.SCALE, PopType.REFRESH_ORDER);\r\n    }\r\n\r\n    /** 仅用于关闭操作 */\r\n    onBtnCloseHandle() {\r\n        super.close();\r\n    }\r\n\r\n    getGuidePoint() {\r\n        // let node = this.xfzsLb.node;\r\n        let p = this.scroller.getItemByIndex(0).convertToWorldSpaceAR(cc.v2(0, 0));\r\n        // let p = node.convertToWorldSpaceAR(cc.v2(0,0));\r\n        return p;\r\n    }\r\n    getGuidePoint1() {\r\n        // let node = this.xfzsLb.node;\r\n        let p = this.scroller.node.convertToWorldSpaceAR(cc.v2(0, 0));\r\n        // let p = node.convertToWorldSpaceAR(cc.v2(0,0));\r\n        return p;\r\n    }\r\n\r\n    guidComplete() {\r\n        this.scroller.vertical = true;\r\n    }\r\n}\r\n"]}