{"version":3,"sources":["assets/src/game/view/level/LevelView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport SDKManager from \"../../../framework/manager/SDKManager\";\r\nimport { UIEffectType } from \"../../../framework/manager/UIEffectManager\";\r\nimport UIMananger from \"../../../framework/manager/UIMananger\";\r\nimport EventDispath from \"../../../framework/message/EventDispath\";\r\nimport { EventType } from \"../../../framework/message/EventType\";\r\nimport SortUtils from \"../../../framework/tools/SortUtils\";\r\nimport Utils from \"../../../framework/tools/Utils\";\r\nimport BasePanel from \"../../../framework/ui/BasePanel\";\r\nimport UIType from \"../../consts/UIType\";\r\nimport PlayerModel from \"../../datas/PlayerModel\";\r\nimport ConfigManager from \"../../manager/ConfigManager\";\r\nimport AVirtualScrollView from \"../task/AVirtualScrollView\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n/**\r\n * 升级界面\r\n * TODO:\r\n * initPropHasList这个方法可以移至更早的登录初始化环节\r\n */\r\n@ccclass\r\nexport default class LevelView extends BasePanel {\r\n\r\n    @property(cc.Node)\r\n    btn_close: cc.Node = null;\r\n    @property(cc.Label)\r\n    titleLb: cc.Label = null;\r\n    @property(cc.Label)\r\n    moneyLb: cc.Label = null;\r\n    @property(cc.RichText)\r\n    descLb1: cc.RichText = null;\r\n    @property(cc.RichText)\r\n    descLb2: cc.RichText = null;\r\n\r\n    @property(AVirtualScrollView)\r\n    scroller: AVirtualScrollView = null;\r\n\r\n    mData;\r\n    scrollerData = [];\r\n    currentItemData;\r\n    nextItemData;\r\n    onEnable(): void {\r\n        // 退出\r\n        EventDispath.on(this.btn_close, this.onBtnCloseHandle, this);\r\n        EventDispath.addEventListener(EventType.LEVEL_UPDATE, this.updateData, this);\r\n        this.initUI();\r\n    }\r\n    protected onLoad(): void {\r\n\r\n    }\r\n    protected start(): void {\r\n    }\r\n\r\n    startShow() {\r\n        this.mData = SDKManager.getBazaarLevelInfo();\r\n\r\n        this.scrollerData = this.mData.jsTaskInfos;\r\n    }\r\n\r\n    updateData() {\r\n        this.mData = SDKManager.getBazaarLevelInfo();\r\n        \r\n        this.scrollerData = this.mData.jsTaskInfos;\r\n        this.initUI();\r\n        UIMananger.showPanel(UIType.levelPopView, null, null, UIEffectType.SCALE, { currentData: this.currentItemData, nextData: this.nextItemData })\r\n    }\r\n    initUI() {\r\n        this.titleLb.string = `集市${this.mData.jsLevel}级`\r\n        this.moneyLb.string = this.mData.jsAmount + \"元\";\r\n        if (this.mData.jsAmount >= 500) {\r\n            this.descLb1.string = \"<color=#708FCC>本次活动已结束，现已为您升级为</c><color=#ED522B>5%红包提现比例</color>\"\r\n        } else {\r\n            this.descLb1.string = \"<color=#708FCC>每满</c><color=#ED522B>500元<color=#708FCC>后自动打款至微信钱包</color>\"\r\n        }\r\n\r\n        let num = 0;\r\n        let isFirst = 1;\r\n        for (let i = 0; i < this.scrollerData.length; i++) {\r\n            let data = this.scrollerData[i];\r\n            data.userOrderNum = this.mData.userOrderNum;\r\n\r\n            if (data.userOrderNum >= data.orderNum) {\r\n                this.scrollerData[i][\"isFirst\"] = isFirst;\r\n                if (isFirst) {\r\n                    this.currentItemData = this.scrollerData[i];\r\n                    if (this.scrollerData[i + 1]) this.nextItemData = this.scrollerData[i + 1]\r\n                }\r\n                isFirst = 0;\r\n            }\r\n\r\n            num += data.amount;\r\n        }\r\n\r\n        this.descLb2.string = `<color=#708FCC>等级越高，奖励越高，累计可得</c><color=#ED522B>${1120}<color=#708FCC>元</color>`\r\n\r\n        this.scroller.refreshData(this.scrollerData);\r\n    }\r\n\r\n\r\n    /** 仅用于关闭操作 */\r\n    onBtnCloseHandle() {\r\n        super.close();\r\n    }\r\n}\r\n"]}