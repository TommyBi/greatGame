{"version":3,"sources":["assets/src/game/view/warehouse/WarehouseView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport EventDispath from \"../../../framework/message/EventDispath\";\r\nimport BasePanel from \"../../../framework/ui/BasePanel\";\r\nimport { propType } from \"../../consts/CConst\";\r\nimport PlayerModel from \"../../datas/PlayerModel\";\r\nimport ConfigManager from \"../../manager/ConfigManager\";\r\nimport AVirtualScrollView from \"../task/AVirtualScrollView\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n/**\r\n * 仓库界面\r\n */\r\n@ccclass\r\nexport default class WarehouseView extends BasePanel {\r\n\r\n    @property(cc.Node)\r\n    btn_close: cc.Node = null;\r\n    @property(AVirtualScrollView)\r\n    uScrollView: AVirtualScrollView = null;\r\n    @property(cc.Label)\r\n    ulabelCount: cc.Label = null;\r\n    @property(cc.Label)\r\n    ulabelMax: cc.Label = null;\r\n    @property(cc.Label)\r\n    proLb: cc.Label = null;\r\n    @property(cc.Node)\r\n    ulabelEmpty: cc.Node = null;\r\n    @property(cc.ProgressBar)\r\n    uBar: cc.ProgressBar = null;\r\n\r\n    wareLv: number = 1;         // 仓库id\r\n    wareCropList: any[] = [];    // 仓库中仍然还有的作物\r\n\r\n    onEnable(): void {\r\n        // 退出\r\n        EventDispath.on(this.btn_close, this.onBtnCloseHandle, this);\r\n        this.initUI();\r\n    }\r\n    onDisable(): void {\r\n    }\r\n\r\n    startShow() {\r\n    }\r\n\r\n    initUI() {\r\n        this.wareCropList = [];\r\n        // 拉取仓库中的作物数据（剔除掉了库存为0的作物）\r\n        let warehouseCropInfo = PlayerModel.getWarerHouseCfg();\r\n        this.wareCropList = warehouseCropInfo.cropList.filter(x => {\r\n            return x.num > 0;\r\n        })\r\n        this.ulabelEmpty.active = !Boolean(this.wareCropList.length > 0);\r\n\r\n\r\n        this.uScrollView.refreshData(this.wareCropList);\r\n\r\n        this.uScrollView.scrollToTop();\r\n        // 持仓\r\n        let total = 0;\r\n        this.wareCropList.map(x => {\r\n            total += x.num;\r\n        })\r\n        this.ulabelCount.string = `${total}`;\r\n\r\n        // TODO:仓库上限\r\n        let max = this.getCurWareHouseCountMax();\r\n        this.ulabelMax.string = `/${max}`;\r\n\r\n        // TODO:进度\r\n        this.uBar.progress = total / max;\r\n\r\n        this.proLb.string = Math.floor(total / max*100) + \"%\";\r\n    }\r\n\r\n    /** 获取仓库存储上限 */\r\n    private getCurWareHouseCountMax(): number {\r\n        this.wareLv = PlayerModel.getUIConfig().warehouselv;\r\n        let arr = ConfigManager.prop.filter((x) => {\r\n            return x.id == Number(propType.warehouse + `0${this.wareLv}`);\r\n        })\r\n        let cfg = arr[0];\r\n        return cfg.add_num;\r\n    }\r\n\r\n    /** 仅用于关闭操作 */\r\n    onBtnCloseHandle() {\r\n        super.close();\r\n    }\r\n}\r\n"]}