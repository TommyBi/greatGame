{"version":3,"sources":["assets/src/framework/manager/DragManager.ts"],"names":[],"mappings":";;;;;;AAEA,kDAA6C;AAC7C,4CAAuC;AACvC,wCAAmC;AAEnC,OAAO;AACP;IAAA;QACY,iBAAY,GAAW,cAAc,CAAC;QACtC,aAAQ,GAAY,IAAI,CAAC;QACzB,UAAK,GAAY,IAAI,CAAC;QACtB,gBAAW,GAAY,KAAK,CAAC;QAC7B,aAAQ,GAAG,IAAI,CAAC;QAChB,kBAAa,GAAY,IAAI,CAAC;QAC9B,eAAU,GAAY,IAAI,CAAC;QAC3B,iBAAY,GAAY,IAAI,CAAC;QAC7B,YAAO,GAAY,IAAI,CAAC;QACxB,WAAM,GAAY,KAAK,CAAC;QAGzB,aAAQ,GAAa,KAAK,CAAC;QAC1B,iBAAY,GAAS,EAAE,CAAC;IAyMpC,CAAC;IArMU,oBAAQ,GAAf;QACI,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACjB,IAAI,CAAC,SAAS,GAAG,IAAI,WAAW,EAAE,CAAC;SACtC;QACD,OAAO,IAAI,CAAC,SAAS,CAAC;IAC1B,CAAC;IAED;;;OAGG;IACH,+BAAS,GAAT,UAAU,MAAe,EAAE,OAAO;QAC9B,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;YACzC,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;YACpB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;SAC1B;IACL,CAAC;IAED,QAAQ;IACR,sCAAgB,GAAhB,UAAiB,WAAW,EAAE,GAAG,EAAE,QAAQ;QACvC,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;QACnB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE;YACzB,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;YACnC,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,GAAG,CAAC;YAC5B,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAA;YACjD,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC;YAC/B,IAAI,EAAE,GAAG,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC;YACnC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,GAAG,GAAG,CAAC,EACzD,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC,CAAA;YACzB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;SACvB;aAAM;YACH,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;SACxB;QACD,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC7E,CAAC;IAED,QAAQ;IACR,oBAAoB;IACpB,OAAO;IACP,wCAAkB,GAAlB,UAAmB,aAAa,EAAE,UAAU,EAAE,YAAY;QACtD,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;QACnC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;IACrC,CAAC;IAED,WAAW;IACX,iCAAW,GAAX,UAAY,KAAK;QACb,mBAAS,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC3D,CAAC;IAEO,oCAAc,GAAtB;QACI,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;YAC7C,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;YACxB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,gBAAgB,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;YAChF,IAAI;YACJ,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,CAAC,kBAAkB,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;YACpF,MAAM;YACN,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;SACjF;IACL,CAAC;IAEO,sCAAgB,GAAxB,UAAyB,KAAK;QAC1B,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,gDAAgD;YAChD,gDAAgD;YAChD,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,oBAAoB,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YAChF,IAAI,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE;gBACtB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;aACvE;SACJ;IACL,CAAC;IAEO,wCAAkB,GAA1B,UAA2B,KAAK;QAC5B,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,8CAA8C;YAC9C,IAAI,IAAI,CAAC,UAAU,EAAE;gBACjB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;aACzF;SACJ;IACL,CAAC;IAEO,qCAAe,GAAvB,UAAwB,KAAK;QACzB,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,8CAA8C;YAC9C,IAAI,IAAI,CAAC,UAAU,EAAE;gBACjB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;aACzF;SACJ;IAEL,CAAC;IAEM,sCAAgB,GAAvB,UAAwB,GAAI,EAAC,QAAS,EAAC,SAAU,EAAC,QAAS,EAAC,MAAO;QAAnE,iBAmEC;QAlEG,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QACzB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;QAC1E,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;QACxE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,CAAC,kBAAkB,EAAE,IAAI,CAAC,CAAC;QAC9E,IAAI,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;YAC3B,IAAI,GAAG,GAAG,CAAC,CAAC;YACZ,qDAAqD;YACrD,IAAG,MAAM,EAAC;gBACN,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,MAAM,CAAC;gBAC7B,GAAG,IAAI,MAAM,CAAC;aACjB;YACD,IAAG,GAAG,EAAC;gBACH,IAAI,KAAG,GAAG,iBAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAAC;gBACvF,yBAAyB;gBACzB,IAAI,SAAS,GAAG,KAAG,GAAC,IAAI,CAAC;gBACzB,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC;oBACxG,IAAI,QAAQ,EAAE;wBACV,QAAQ,CAAC,IAAI,CAAC,KAAI,CAAC,OAAO,CAAC,CAAC;qBAC/B;oBACD,KAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC;gBAC9B,CAAC,CAAC,CAAC,CAAC,CAAA;aACP;iBAAI;gBACD,wBAAwB;gBACxB,IAAI,QAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;gBACjC,IAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,oBAAoB,CAAC,SAAS,CAAC,CAAC;gBACxE,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;gBACnC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAC/B,EAAE,CAAC,OAAO,CAAC,eAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAC,GAAG,CAAC,EAC5B,EAAE,CAAC,KAAK,CACJ,EAAE,CAAC,MAAM,CAAC,eAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAC,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,GAAG,GAAG,EAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC,EACnF,EAAE,CAAC,OAAO,CAAC,eAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAC,QAAM,EAAE,QAAM,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC,CAAC,EACvE,EAAE,CAAC,SAAS,CAAC,eAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAC1B,EAAE,CAAC,KAAK,CACJ,EAAE,CAAC,MAAM,CAAC,eAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAC,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,EAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC;gBAC7E,2DAA2D;gBAC3D,2BAA2B;gBAC3B,EAAE,CAAC,MAAM,CAAC,eAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAC,EAAE,CAAC,CACzB,EACL,EAAE,CAAC,QAAQ,CAAC;oBACR,KAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC;oBAC1B,KAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,GAAG,CAAC;oBAC3B,yBAAyB;oBACzB,QAAQ,IAAI,QAAQ,EAAE,CAAC;gBAC3B,CAAC,CAAC,CACL,CAAC,CAAC;gBACH,uCAAuC;gBACvC,mHAAmH;gBACnH,8CAA8C;gBAC9C,wBAAwB;gBACxB,sCAAsC;gBACtC,UAAU;gBACV,8CAA8C;gBAC9C,6CAA6C;gBAC7C,uCAAuC;gBACvC,8EAA8E;gBAC9E,qCAAqC;gBACrC,sCAAsC;gBACtC,kCAAkC;gBAClC,SAAS;gBACT,MAAM;gBACN,sGAAsG;gBACtG,iCAAiC;gBACjC,OAAO;aACV;SACJ;QACD,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;IACzB,CAAC;IAEO,iCAAW,GAAnB,UAAoB,IAAI,EAAE,GAAG;QACzB,IAAI,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;YAC3B,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC;YACzD,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;YACxB,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;SAC3B;IACL,CAAC;IAEO,oCAAc,GAAtB;QACI,IAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QACpC,IAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAC;YACzB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;YAC1C,OAAO;SACV;QACD,IAAI,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;YAC3B,OAAO,IAAI,CAAC,QAAQ,CAAC;SACxB;QACD,IAAI,CAAC,QAAQ,GAAG,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;QAC9B,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QACtC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC;QAClC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC;IAC9C,CAAC;IACM,yCAAmB,GAA1B;QACI,IAAG,CAAC,IAAI,CAAC,QAAQ,EAAC;YACd,OAAO,EAAE,CAAC,EAAE,EAAE,CAAC;SAClB;QACD,OAAO,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,qBAAqB,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC;IACxF,CAAC;IAED,WAAW;IACX,iCAAW,GAAX;QACI,OAAO,IAAI,CAAC,QAAQ,CAAC;IACzB,CAAC;IACL,kBAAC;AAAD,CAvNA,AAuNC,IAAA;AAED,kBAAe,WAAW,CAAC,QAAQ,EAAE,CAAC","file":"","sourceRoot":"/","sourcesContent":["import Global from \"../../game/consts/Global\";\r\nimport Handler from \"../base/Handler\";\r\nimport NResponer from \"../message/NResponer\";\r\nimport MKUtils from \"../tools/MkUtils\";\r\nimport Utils from \"../tools/Utils\";\r\n\r\n//拖拽管理类\r\nclass DragManager {\r\n    private BaseDropName: string = 'BaseDropItem';\r\n    private tempItem: cc.Node = null;\r\n    private stage: cc.Node = null;\r\n    private isInitEvent: boolean = false;\r\n    private dragData = null;\r\n    private updateHandler: Handler = null;\r\n    private endHandler: Handler = null;\r\n    private startHandler: Handler = null;\r\n    private canDrag: boolean = true;\r\n    private isInit: boolean = false;\r\n    private thisObj: any;\r\n    private initPos: any;//初始位置\r\n    public _inMerge : boolean = false;\r\n    private tempItemList : any = {};\r\n\r\n    private static _instance: DragManager;\r\n\r\n    static instance(): DragManager {\r\n        if (!this._instance) {\r\n            this._instance = new DragManager();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    /**\r\n     * 初始化顶级\r\n     * @param screen \r\n     */\r\n    initStage(screen: cc.Node, thisObj) {\r\n        if (!this.isInit && !cc.isValid(this.stage)) {\r\n            this.stage = screen;\r\n            this.isInit = true;\r\n            this.thisObj = thisObj;\r\n        }\r\n    }\r\n\r\n    //开始拖动动画\r\n    startDragHandler(spriteFrame, pos, dragData) {\r\n        this.initPos = pos;\r\n        this.dragData = dragData;\r\n        this.initStageEvent();\r\n        if (cc.isValid(spriteFrame)) {\r\n            this.setDragSkin(spriteFrame, pos);\r\n            this.tempItem.opacity = 255;\r\n            this.tempItem.setScale(dragData.moveTarget.scale)\r\n            this.tempItem.stopAllActions();\r\n            let sc = dragData.moveTarget.scale;\r\n            this.tempItem.runAction(cc.sequence(cc.scaleTo(0.2, sc + 0.2),\r\n                cc.scaleTo(0.2, sc)))\r\n            this.canDrag = true;\r\n        } else {\r\n            this.canDrag = false;\r\n        }\r\n        this.startHandler && this.startHandler.call(this.thisObj, this.dragData);\r\n    }\r\n\r\n    //设置回调函数\r\n    //updateHandler 更新函数\r\n    //返回时回调\r\n    setCallBackHandler(updateHandler, endHandler, startHandler) {\r\n        this.updateHandler = updateHandler;\r\n        this.endHandler = endHandler;\r\n        this.startHandler = startHandler;\r\n    }\r\n\r\n    //拖放是否成功的回调\r\n    dragSuccess(state) {\r\n        NResponer.dispatch('dragStatus', state, this.dragData);\r\n    }\r\n\r\n    private initStageEvent() {\r\n        if (!this.isInitEvent && cc.isValid(this.stage)) {\r\n            this.createTempItem();\r\n            this.isInitEvent = true;\r\n            this.stage.on(cc.Node.EventType.TOUCH_MOVE, this.moveTouchHandler, this, false);\r\n            //取消\r\n            this.stage.on(cc.Node.EventType.TOUCH_CANCEL, this.cancelTouchHandler, this, false);\r\n            //鼠标弹起\r\n            this.stage.on(cc.Node.EventType.TOUCH_END, this.endTouchHandler, this, false);\r\n        }\r\n    }\r\n\r\n    private moveTouchHandler(event) {\r\n        if (this.canDrag) {\r\n            // this.tempItem.x = event.getLocationX() - 640;\r\n            // this.tempItem.y = event.getLocationY() - 360;\r\n            this.tempItem.setPosition(this.stage.convertToNodeSpaceAR(event.getLocation()));\r\n            if (!!this.updateHandler) {\r\n                this.updateHandler.call(this.thisObj, this.tempItem, this.dragData);\r\n            }\r\n        }\r\n    }\r\n\r\n    private cancelTouchHandler(event) {\r\n        if (this.canDrag) {\r\n            // this.removeStageEvent(event.getLocation());\r\n            if (this.endHandler) {\r\n                this.endHandler.call(this.thisObj, this.tempItem, this.dragData, event.getLocation());\r\n            }\r\n        }\r\n    }\r\n\r\n    private endTouchHandler(event) {\r\n        if (this.canDrag) {\r\n            // this.removeStageEvent(event.getLocation());\r\n            if (this.endHandler) {\r\n                this.endHandler.call(this.thisObj, this.tempItem, this.dragData, event.getLocation());\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    public removeStageEvent(pos?,callBack?,targetPos?,targetCb?,mScale?) {\r\n        this.isInitEvent = false;\r\n        this.stage.off(cc.Node.EventType.TOUCH_MOVE, this.moveTouchHandler, this);\r\n        this.stage.off(cc.Node.EventType.TOUCH_END, this.endTouchHandler, this);\r\n        this.stage.off(cc.Node.EventType.TOUCH_CANCEL, this.cancelTouchHandler, this);\r\n        if (cc.isValid(this.tempItem)) {\r\n            let dis = 0;\r\n            // let dis = Global.HANDLE_FEEL_ANIMAL_COLLISION_DIS;\r\n            if(mScale){\r\n                this.tempItem.scale = mScale;\r\n                dis *= mScale;\r\n            }\r\n            if(pos){\r\n                let dis = MKUtils.twoPointDistance(this.initPos, this.stage.convertToNodeSpaceAR(pos));\r\n                // cc.log(\"distance\",dis)\r\n                let delayTime = dis/2000;\r\n                this.tempItem.runAction(cc.sequence(cc.moveTo(delayTime, this.initPos).easing(cc.easeSineIn()), cc.callFunc(() => {\r\n                    if (callBack) {\r\n                        callBack.call(this.thisObj);\r\n                    }\r\n                    this.tempItem.opacity = 0;\r\n                })))\r\n            }else{\r\n                // this._inMerge = true;\r\n                let mScale = this.tempItem.scale;\r\n                let nodePos = this.tempItem.getParent().convertToNodeSpaceAR(targetPos);\r\n                this.tempItem.setPosition(nodePos);\r\n                this.tempItem.runAction(cc.sequence(\r\n                    cc.scaleTo(Utils._FT(3),0.3),\r\n                    cc.spawn(\r\n                        cc.moveTo(Utils._FT(5),cc.v2(nodePos.x + dis,nodePos.y)).easing(cc.easeSineInOut()),\r\n                        cc.scaleTo(Utils._FT(5),mScale ,mScale).easing(cc.easeSineInOut())),\r\n                    cc.delayTime(Utils._FT(3)),\r\n                    cc.spawn(\r\n                        cc.moveTo(Utils._FT(3),cc.v2(nodePos.x,nodePos.y)).easing(cc.easeSineInOut()),\r\n                        // cc.scaleTo(Utils._FT(10),0.3).easing(cc.easeSineInOut())\r\n                        // cc.fadeOut(Utils._FT(5))\r\n                        cc.fadeTo(Utils._FT(3),85)\r\n                        ),\r\n                    cc.callFunc(()=>{\r\n                        this.tempItem.opacity = 0;\r\n                        this.tempItem.zIndex = 999;\r\n                        // this._inMerge = false;\r\n                        targetCb && targetCb();\r\n                    })\r\n                ));\r\n                // this.tempItem.runAction(cc.sequence(\r\n                //     cc.spawn(cc.scaleTo(Utils._FT(3),mScale * 1.8),cc.fadeTo(Utils._FT(3),200),cc.moveTo(Utils._FT(3),nodePos)),\r\n                //     cc.scaleTo(Utils._FT(3),mScale * 0.90),\r\n                //     cc.callFunc(()=>{\r\n                //         this.tempItem.zIndex = -10;\r\n                //     }),\r\n                //     cc.scaleTo(Utils._FT(2),mScale * 1.35),\r\n                //     cc.scaleTo(Utils._FT(2),mScale * 0.9),\r\n                //     cc.scaleTo(Utils._FT(3),mScale),\r\n                //     cc.scaleTo(Utils._FT(3),0).easing(cc.easeSineIn()), cc.callFunc(() => {\r\n                //         this.tempItem.opacity = 0;\r\n                //         this.tempItem.zIndex = 999;\r\n                //         targetCb && targetCb();\r\n                //     })\r\n                // ));\r\n                // this.tempItem.runAction(cc.sequence(cc.scaleTo(0.2, 0).easing(cc.easeSineIn()), cc.callFunc(() => {\r\n                //     this.tempItem.opacity = 0;\r\n                // })))\r\n            }\r\n        }\r\n        this.canDrag = false;\r\n    }\r\n\r\n    private setDragSkin(skin, pos) {\r\n        if (cc.isValid(this.tempItem)) {\r\n            this.tempItem.getComponent(cc.Sprite).spriteFrame = skin;\r\n            this.tempItem.x = pos.x;\r\n            this.tempItem.y = pos.y;\r\n        }\r\n    }\r\n\r\n    private createTempItem() {\r\n        let mIndex = this.dragData[\"index\"];\r\n        if(this.tempItemList[mIndex]){\r\n            this.tempItem = this.tempItemList[mIndex];\r\n            return;\r\n        }\r\n        if (cc.isValid(this.tempItem)) {\r\n            return this.tempItem;\r\n        }\r\n        this.tempItem = new cc.Node();\r\n        this.tempItem.addComponent(cc.Sprite);\r\n        this.tempItem.parent = this.stage;\r\n        this.tempItemList[mIndex] = this.tempItem;\r\n    }\r\n    public getTempItemWorldPos(){\r\n        if(!this.tempItem){\r\n            return cc.v2();\r\n        }\r\n        return this.tempItem.getParent().convertToWorldSpaceAR(this.tempItem.getPosition());\r\n    }\r\n\r\n    //获得拖拽对象的数据\r\n    getDragData() {\r\n        return this.dragData;\r\n    }\r\n}\r\n\r\nexport default DragManager.instance();"]}