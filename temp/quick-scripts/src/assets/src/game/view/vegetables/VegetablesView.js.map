{"version":3,"sources":["assets/src/game/view/vegetables/VegetablesView.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,wEAAwE;AACxE,mBAAmB;AACnB,kFAAkF;AAClF,8BAA8B;AAC9B,kFAAkF;;;;;;;;;;;;;;;;;;;;;AAElF,8EAA0E;AAC1E,oEAA+D;AAC/D,wEAAmE;AACnE,kEAAiE;AACjE,4DAAuD;AACvD,6DAAwD;AAExD,8CAAyC;AACzC,uDAAkD;AAClD,6DAAwD;AACxD,iEAA4D;AAGtD,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAE5C;;;;;GAKG;AAEH;IAA4C,kCAAS;IAArD;QAAA,qEA0HC;QAvHG,eAAS,GAAY,IAAI,CAAA;QAEzB,cAAQ,GAAY,IAAI,CAAA;QAGxB,cAAQ,GAAuB,IAAI,CAAC;QAGpC,oBAAc,GAAc,IAAI,CAAC;QAEjC,iBAAW,GAAG,EAAE,CAAC;;IA6GrB,CAAC;IA1GG,iCAAQ,GAAR;QACI,KAAK;QACL,sBAAY,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;QAC7D,OAAO;QACP,sBAAY,CAAC,gBAAgB,CAAC,qBAAS,CAAC,UAAU,EAAE,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;QACjF,MAAM;QACN,sBAAY,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;QAEtD,sBAAY,CAAC,gBAAgB,CAAC,qBAAS,CAAC,iBAAiB,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAG9E,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QAClC,+DAA+D;QAC/D,IAAI,CAAC,MAAM,EAAE,CAAC;IAElB,CAAC;IACD,kCAAS,GAAT;IACA,CAAC;IAED,gCAAO,GAAP,UAAQ,IAAS;QACb,iBAAiB;QACjB,kEAAkE;QAClE,iBAAM,OAAO,YAAC,IAAI,CAAC,CAAC;IACxB,CAAC;IACS,8BAAK,GAAf;QACI,IAAI,qBAAW,CAAC,SAAS,IAAI,CAAC,EAAE;YAC5B,iBAAO,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE;gBACjC,sBAAY,CAAC,IAAI,CAAC,qBAAS,CAAC,YAAY,CAAC,CAAA;YAE7C,CAAC,CAAC,CAAA;SACL;IACL,CAAC;IAED,+BAAM,GAAN;QAAA,iBAqCC;QApCG,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QACvB,IAAI,CAAC,YAAY,GAAG,uBAAa,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAChD,KAAK;QACL,IAAI,CAAC,WAAW,GAAG,qBAAW,CAAC,aAAa,EAAE,CAAC;QAC/C,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAC,CAAC,EAAE,CAAC;YACvB,OAAO,CAAC,GAAG,CAAC,CAAC;QACjB,CAAC,CAAC,CAAA;QACF,IAAI,QAAQ,GAAG,CAAC,CAAC;QAEjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC/C,IAAI,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC/B,IAAI,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC;YACpD,IAAI,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;YACxC,IAAI,IAAI,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC;YAChD,IAAI,OAAO;gBAAE,QAAQ,GAAG,CAAC,CAAC;YAC1B,KAAK,IAAI,GAAG,IAAI,IAAI,EAAE;gBAClB,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;aACxB;YACD,kDAAkD;YAClD,cAAc;YACd,6CAA6C;YAC7C,2CAA2C;YAC3C,IAAI;SAEP;QAED,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAE7C,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC;QAC5B,iBAAO,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE;YACjC,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACrC,CAAC,CAAC,CAAA;QACF,uBAAuB;QACvB,0CAA0C;QAC1C,IAAI;IAER,CAAC;IACD,UAAU;IACV,qCAAY,GAAZ,UAAa,EAAE;QACX,IAAI,qBAAW,CAAC,SAAS,EAAE,EAAE;YACzB,IAAI,SAAS,GAAG,qBAAW,CAAC,eAAe,EAAE,CAAC,QAAQ,CAAC;YACvD,IAAI,GAAG,GAAG,SAAS,CAAC,MAAM,CAAC,UAAC,IAAI;gBAC5B,OAAO,IAAI,CAAC,MAAM,IAAI,EAAE,CAAC;YAC7B,CAAC,CAAC,CAAA;YACF,IAAI,GAAG,CAAC,MAAM,GAAG,CAAC;gBAAE,OAAO,IAAI,CAAC;SACnC;QAED,OAAO,KAAK,CAAC;IACjB,CAAC;IAED,mCAAU,GAAV;QACI,UAAU;QACV,oBAAU,CAAC,SAAS,CAAC,gBAAM,CAAC,QAAQ,EAAE,IAAI,EAAE,IAAI,EAAE,8BAAY,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QACzE,IAAI,CAAC,gBAAgB,EAAE,CAAC;IAC5B,CAAC;IAGD,cAAc;IACd,yCAAgB,GAAhB;QACI,sBAAY,CAAC,IAAI,CAAC,qBAAS,CAAC,eAAe,CAAC,CAAA;QAC5C,iBAAM,KAAK,WAAE,CAAC;IAClB,CAAC;IAED,sCAAa,GAAb;QACI,IAAI,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAC3E,OAAO,CAAC,CAAC;IACb,CAAC;IACD,uCAAc,GAAd;QACI,IAAI,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAC3E,OAAO,CAAC,CAAC;IACb,CAAC;IArHD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;qDACO;IAEzB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;oDACM;IAGxB;QADC,QAAQ,CAAC,4BAAkB,CAAC;oDACO;IAGpC;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;0DACa;IAXhB,cAAc;QADlC,OAAO;OACa,cAAc,CA0HlC;IAAD,qBAAC;CA1HD,AA0HC,CA1H2C,mBAAS,GA0HpD;kBA1HoB,cAAc","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport { UIEffectType } from \"../../../framework/manager/UIEffectManager\";\r\nimport UIMananger from \"../../../framework/manager/UIMananger\";\r\nimport EventDispath from \"../../../framework/message/EventDispath\";\r\nimport { EventType } from \"../../../framework/message/EventType\";\r\nimport MKUtils from \"../../../framework/tools/MkUtils\";\r\nimport BasePanel from \"../../../framework/ui/BasePanel\";\r\nimport { crop_config } from \"../../consts/CConst\";\r\nimport UIType from \"../../consts/UIType\";\r\nimport PlayerModel from \"../../datas/PlayerModel\";\r\nimport ConfigManager from \"../../manager/ConfigManager\";\r\nimport AVirtualScrollView from \"../task/AVirtualScrollView\";\r\nimport VegetablesItem from \"./VegetablesItem\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n/**\r\n * 种菜界面\r\n * TODO:\r\n * 1、未解锁的图标显示的形式是蒙灰的效果还是加个锁子的效果；\r\n * 2、种菜界面的文档介绍要求点击解锁的是直接购买，但在详情界面是有已经解锁的蔬菜界面，同时点击详情界面的也可以购买，这里两段文档似乎有些冲突，目前处理方式是都弹详情，在详情中完成购买操作\r\n */\r\n@ccclass\r\nexport default class VegetablesView extends BasePanel {\r\n\r\n    @property(cc.Node)\r\n    btn_close: cc.Node = null\r\n    @property(cc.Node)\r\n    btn_lvUp: cc.Node = null\r\n\r\n    @property(AVirtualScrollView)\r\n    scroller: AVirtualScrollView = null;\r\n\r\n    @property(cc.Prefab)\r\n    VegetablesItem: cc.Prefab = null;\r\n\r\n    haveCropIds = [];\r\n\r\n    scrollerData: any[];\r\n    onEnable(): void {\r\n        // 退出\r\n        EventDispath.on(this.btn_close, this.onBtnCloseHandle, this);\r\n        // 购买成功\r\n        EventDispath.addEventListener(EventType.CROP_PLANT, this.onBtnCloseHandle, this);\r\n        //土地升级\r\n        EventDispath.on(this.btn_lvUp, this.onOpenLvUp, this);\r\n\r\n        EventDispath.addEventListener(EventType.VEGETABLES_UPDATE, this.initUI, this);\r\n\r\n\r\n        this.scroller.node.active = false;\r\n        // MKUtils.setNodeDelay(this.node, 0.1, this.initUI.bind(this))\r\n        this.initUI();\r\n\r\n    }\r\n    onDisable(): void {\r\n    }\r\n\r\n    on_Show(args: any): void {\r\n        // this.initUI();\r\n        // // MKUtils.setNodeDelay(this.node, 0.1, this.initUI.bind(this))\r\n        super.on_Show(args);\r\n    }\r\n    protected start(): void {\r\n        if (PlayerModel.guideStep >= 0) {\r\n            MKUtils.setNodeDelay(this.node, 0.5, () => {\r\n                EventDispath.send(EventType.GUIDE_UPDATE)\r\n\r\n            })\r\n        }\r\n    }\r\n\r\n    initUI() {\r\n        this.scrollerData = [];\r\n        this.scrollerData = ConfigManager.crop.slice(1);\r\n        // 库存\r\n        this.haveCropIds = PlayerModel.getUnlockCrop();\r\n        this.haveCropIds.sort((a, b) => {\r\n            return a - b;\r\n        })\r\n        let hotIndex = 0;\r\n\r\n        for (let i = 0; i < this.scrollerData.length; i++) {\r\n            let cfg = this.scrollerData[i];\r\n            let isLock = this.haveCropIds.indexOf(cfg.id) == -1;\r\n            let isOrder = this.checkInOrder(cfg.id);\r\n            let data = { isLock: isLock, isOrder: isOrder };\r\n            if (isOrder) hotIndex = i;\r\n            for (let key in data) {\r\n                cfg[key] = data[key];\r\n            }\r\n            // let item = cc.instantiate(this.VegetablesItem);\r\n            // if (item) {\r\n            // if (i == 0) this.guideItem = item;//引导item\r\n            // this.uScrollView.content.addChild(item);\r\n            // }\r\n\r\n        }\r\n\r\n        this.scroller.refreshData(this.scrollerData);\r\n\r\n        this.scroller.scrollToTop();\r\n        MKUtils.setNodeDelay(this.node, 0.1, () => {\r\n            this.scroller.node.active = true;\r\n        })\r\n        // if (hotIndex > 12) {\r\n        //     this.scroller.scrollTo(cc.v2(0, 0))\r\n        // }\r\n\r\n    }\r\n    //检测是否在订单中\r\n    checkInOrder(id) {\r\n        if (PlayerModel.haveOrder()) {\r\n            let orderList = PlayerModel.getCurrentOrder().cropList;\r\n            let arr = orderList.filter((data) => {\r\n                return data.cropId == id;\r\n            })\r\n            if (arr.length > 0) return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    onOpenLvUp() {\r\n        //打开集市管理页面\r\n        UIMananger.showPanel(UIType.LvUpView, null, null, UIEffectType.SCALE, 1);\r\n        this.onBtnCloseHandle();\r\n    }\r\n\r\n\r\n    /** 仅用于关闭操作 */\r\n    onBtnCloseHandle() {\r\n        EventDispath.send(EventType.VEGETABLE_CLOSE)\r\n        super.close();\r\n    }\r\n\r\n    getGuidePoint() {\r\n        let p = this.scroller.getItemByIndex(0).convertToWorldSpaceAR(cc.v2(0, 0));\r\n        return p;\r\n    }\r\n    getGuidePoint1() {\r\n        let p = this.scroller.getItemByIndex(1).convertToWorldSpaceAR(cc.v2(0, 0));\r\n        return p;\r\n    }\r\n\r\n}\r\n"]}