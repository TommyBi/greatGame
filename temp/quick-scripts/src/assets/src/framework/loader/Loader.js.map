{"version":3,"sources":["assets/src/framework/loader/Loader.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import LoaderItem from \"./LoaderItem\";\r\n\r\n//资源加载器\r\nexport default class Loader {\r\n    private needRelease:boolean;//是否需要释放\r\n    public moduleName:string = null;\r\n    private cacheItems:Array<LoaderItem> = [];\r\n    public isRelease:boolean = false;     //释放已经释放过了\r\n\r\n    constructor(isRelease:boolean){\r\n        this.needRelease = isRelease;\r\n    }\r\n\r\n    addLoaderItem(url,type,handler){\r\n        let res = cc.loader.getRes(url,type);\r\n        if (cc.isValid(res)) {\r\n            !!handler && handler.call(res,url);\r\n            return;\r\n        }\r\n        if (this._checkSameURL(url,handler)) {\r\n            return;\r\n        }\r\n        let item = this.getLoaderItem();\r\n        item.load(url,type,handler);\r\n    }\r\n\r\n    //检查相同的加载路径 保证只存在一个\r\n    _checkSameURL(url,handler){\r\n        let len = this.cacheItems.length\r\n        for (let i = 0; i < len;i++) {\r\n            if (!this.cacheItems[i].isActive) {\r\n                if (this.cacheItems[i].url === url) {\r\n                    this.cacheItems[i].addSame(handler);\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    //获得一个加载item\r\n    getLoaderItem(){\r\n        let len = this.cacheItems.length;\r\n        for (let i = 0; i < len; i++) {\r\n            if (this.cacheItems[i].isActive) {\r\n                this.cacheItems[i].isActive = false;\r\n                return this.cacheItems[i];\r\n            }\r\n        }\r\n        let item = new LoaderItem();\r\n        item.isActive = false;\r\n        this.cacheItems.push(item);\r\n        return item;\r\n    }\r\n\r\n    getAllResUID(exsits){\r\n        if (exsits) {\r\n            let len = this.cacheItems.length\r\n            for (let i = 0; i < len; i++) {\r\n                if (!this.cacheItems[i].isActive) {\r\n                    this.cacheItems[i].setExsitRes(exsits);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    releaseItem(){\r\n        let len = this.cacheItems.length;\r\n        for (let i = 0; i < len;i++) {\r\n            this.cacheItems[i].reset();\r\n        }\r\n    }\r\n\r\n    release(exsits) {\r\n        let len = this.cacheItems.length;\r\n        if (this.needRelease && !this.isRelease) {\r\n            for (let i = 0; i < len;i++) {\r\n                if (!this.cacheItems[i].isActive) {\r\n                    this.cacheItems[i].release(exsits);\r\n                }\r\n            }\r\n            \r\n        }\r\n        this.releaseItem();\r\n    }\r\n\r\n}\r\n"]}