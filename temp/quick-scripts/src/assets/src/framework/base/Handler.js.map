{"version":3,"sources":["assets/src/framework/base/Handler.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nexport default class Handler\r\n{\r\n    private callBack:Function;\r\n    private host:any;\r\n    private args:Array<any>;\r\n    private active:boolean = true;\r\n    private id:number;\r\n    private once:boolean;\r\n    private static index:number = 0;\r\n    private static handler_cache:Array<Handler> = [];\r\n    private static hostUUID:number = 1000;\r\n\r\n    private constructor(fun:Function,host:any,once:boolean = true,...args){\r\n        this.callBack = fun;\r\n        this.host = host;\r\n        this.args = args;\r\n        this.once = once;\r\n        this.id = Handler.index + 1;\r\n    }\r\n\r\n    /**\r\n     * 创建回调句柄\r\n     * @param fun 回调函数\r\n     * @param host 函数指向\r\n     * @param isOnce 是否调用一次后释放\r\n     */\r\n    static create(fun:Function,host:any,isOnce:boolean= true,...args){\r\n        let len = Handler.handler_cache.length;\r\n        for(let i = 0;i < len; i++)\r\n            {\r\n                if(!Handler.handler_cache[i].active)\r\n                {\r\n                    Handler.handler_cache[i].active = true;\r\n                    Handler.handler_cache[i].callBack = fun;\r\n                    Handler.handler_cache[i].host = host;\r\n                    if (!host.hasOwnProperty('hostUuid')) {\r\n                        host.hostUuid = Handler.hostUUID++;\r\n                    }\r\n                    if(!!args)\r\n                    {\r\n                        Handler.handler_cache[i].args = args;\r\n                    }\r\n                    else\r\n                    {\r\n                        !!Handler.handler_cache[i].args ? Handler.handler_cache[i].args.length = 0 : Handler.handler_cache[i].args = [];\r\n                    }\r\n                    Handler.handler_cache[i].once = isOnce;\r\n                    return Handler.handler_cache[i];\r\n                }\r\n            }\r\n            let handler = new Handler(fun,host,isOnce,...args);\r\n            if (!host.hasOwnProperty('hostUuid')) {\r\n                host.hostUuid = Handler.hostUUID++;\r\n            }\r\n            Handler.handler_cache.push(handler);\r\n            return handler;\r\n    }\r\n    /**\r\n     * 释放当前host上的所有handler\r\n     * @param host \r\n     */\r\n    static releaseByHost(host:any){\r\n        if (!!host) {\r\n            let len = Handler.handler_cache.length;\r\n            for (let i = 0 ; i < len; i++) {\r\n                if (!!Handler.handler_cache[i].host) {\r\n                    if (host.hostUuid === Handler.handler_cache[i].host.hostUuid) {\r\n                        Handler.handler_cache[i].active = false;\r\n                        Handler.handler_cache[i].host = null;\r\n                        Handler.handler_cache[i].callBack = null;\r\n                    }\r\n                }\r\n                \r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 是否host 当前正在拥有这个handler\r\n     * @param host \r\n     */\r\n    isHostOwn(host)\r\n    {\r\n        if (!!host && host.hasOwnProperty('hostUuid')) {\r\n            if (!!this.host) {\r\n                if (this.host.hostUuid === host.hostUuid) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 调用handler\r\n     * @param args \r\n     */\r\n    call(...args)\r\n    {\r\n        if(!!this.host)\r\n        {\r\n            for (let i = 0; i < this.args.length; i++) {\r\n                args.push(this.args[i]);\r\n            }\r\n            let result = this.callBack.apply(this.host,args);\r\n            if(this.once)\r\n            {\r\n                this.active = false;\r\n                this.callBack = null;\r\n                this.host = null;\r\n            }\r\n            return result;\r\n        }\r\n        else\r\n        {\r\n            cc.error(\"handler 调用时 this 对象不存在:\"+this.callBack);\r\n        }\r\n    }\r\n    \r\n    equal(handler:Handler)\r\n    {\r\n        if (!!handler && this.id === handler.id) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 释放当前handler\r\n     */\r\n    release()\r\n    {\r\n        this.host = null;\r\n        this.callBack = null;\r\n        this.args.length = 0;\r\n        this.active = false;\r\n    }\r\n}"]}