
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/src/framework/manager/DragManager.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f73242JYXdC/LQGTZZQMl2I', 'DragManager');
// src/framework/manager/DragManager.ts

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var NResponer_1 = require("../message/NResponer");
var MkUtils_1 = require("../tools/MkUtils");
var Utils_1 = require("../tools/Utils");
//拖拽管理类
var DragManager = /** @class */ (function () {
    function DragManager() {
        this.BaseDropName = 'BaseDropItem';
        this.tempItem = null;
        this.stage = null;
        this.isInitEvent = false;
        this.dragData = null;
        this.updateHandler = null;
        this.endHandler = null;
        this.startHandler = null;
        this.canDrag = true;
        this.isInit = false;
        this._inMerge = false;
        this.tempItemList = {};
    }
    DragManager.instance = function () {
        if (!this._instance) {
            this._instance = new DragManager();
        }
        return this._instance;
    };
    /**
     * 初始化顶级
     * @param screen
     */
    DragManager.prototype.initStage = function (screen, thisObj) {
        if (!this.isInit && !cc.isValid(this.stage)) {
            this.stage = screen;
            this.isInit = true;
            this.thisObj = thisObj;
        }
    };
    //开始拖动动画
    DragManager.prototype.startDragHandler = function (spriteFrame, pos, dragData) {
        this.initPos = pos;
        this.dragData = dragData;
        this.initStageEvent();
        if (cc.isValid(spriteFrame)) {
            this.setDragSkin(spriteFrame, pos);
            this.tempItem.opacity = 255;
            this.tempItem.setScale(dragData.moveTarget.scale);
            this.tempItem.stopAllActions();
            var sc = dragData.moveTarget.scale;
            this.tempItem.runAction(cc.sequence(cc.scaleTo(0.2, sc + 0.2), cc.scaleTo(0.2, sc)));
            this.canDrag = true;
        }
        else {
            this.canDrag = false;
        }
        this.startHandler && this.startHandler.call(this.thisObj, this.dragData);
    };
    //设置回调函数
    //updateHandler 更新函数
    //返回时回调
    DragManager.prototype.setCallBackHandler = function (updateHandler, endHandler, startHandler) {
        this.updateHandler = updateHandler;
        this.endHandler = endHandler;
        this.startHandler = startHandler;
    };
    //拖放是否成功的回调
    DragManager.prototype.dragSuccess = function (state) {
        NResponer_1.default.dispatch('dragStatus', state, this.dragData);
    };
    DragManager.prototype.initStageEvent = function () {
        if (!this.isInitEvent && cc.isValid(this.stage)) {
            this.createTempItem();
            this.isInitEvent = true;
            this.stage.on(cc.Node.EventType.TOUCH_MOVE, this.moveTouchHandler, this, false);
            //取消
            this.stage.on(cc.Node.EventType.TOUCH_CANCEL, this.cancelTouchHandler, this, false);
            //鼠标弹起
            this.stage.on(cc.Node.EventType.TOUCH_END, this.endTouchHandler, this, false);
        }
    };
    DragManager.prototype.moveTouchHandler = function (event) {
        if (this.canDrag) {
            // this.tempItem.x = event.getLocationX() - 640;
            // this.tempItem.y = event.getLocationY() - 360;
            this.tempItem.setPosition(this.stage.convertToNodeSpaceAR(event.getLocation()));
            if (!!this.updateHandler) {
                this.updateHandler.call(this.thisObj, this.tempItem, this.dragData);
            }
        }
    };
    DragManager.prototype.cancelTouchHandler = function (event) {
        if (this.canDrag) {
            // this.removeStageEvent(event.getLocation());
            if (this.endHandler) {
                this.endHandler.call(this.thisObj, this.tempItem, this.dragData, event.getLocation());
            }
        }
    };
    DragManager.prototype.endTouchHandler = function (event) {
        if (this.canDrag) {
            // this.removeStageEvent(event.getLocation());
            if (this.endHandler) {
                this.endHandler.call(this.thisObj, this.tempItem, this.dragData, event.getLocation());
            }
        }
    };
    DragManager.prototype.removeStageEvent = function (pos, callBack, targetPos, targetCb, mScale) {
        var _this = this;
        this.isInitEvent = false;
        this.stage.off(cc.Node.EventType.TOUCH_MOVE, this.moveTouchHandler, this);
        this.stage.off(cc.Node.EventType.TOUCH_END, this.endTouchHandler, this);
        this.stage.off(cc.Node.EventType.TOUCH_CANCEL, this.cancelTouchHandler, this);
        if (cc.isValid(this.tempItem)) {
            var dis = 0;
            // let dis = Global.HANDLE_FEEL_ANIMAL_COLLISION_DIS;
            if (mScale) {
                this.tempItem.scale = mScale;
                dis *= mScale;
            }
            if (pos) {
                var dis_1 = MkUtils_1.default.twoPointDistance(this.initPos, this.stage.convertToNodeSpaceAR(pos));
                // cc.log("distance",dis)
                var delayTime = dis_1 / 2000;
                this.tempItem.runAction(cc.sequence(cc.moveTo(delayTime, this.initPos).easing(cc.easeSineIn()), cc.callFunc(function () {
                    if (callBack) {
                        callBack.call(_this.thisObj);
                    }
                    _this.tempItem.opacity = 0;
                })));
            }
            else {
                // this._inMerge = true;
                var mScale_1 = this.tempItem.scale;
                var nodePos = this.tempItem.getParent().convertToNodeSpaceAR(targetPos);
                this.tempItem.setPosition(nodePos);
                this.tempItem.runAction(cc.sequence(cc.scaleTo(Utils_1.default._FT(3), 0.3), cc.spawn(cc.moveTo(Utils_1.default._FT(5), cc.v2(nodePos.x + dis, nodePos.y)).easing(cc.easeSineInOut()), cc.scaleTo(Utils_1.default._FT(5), mScale_1, mScale_1).easing(cc.easeSineInOut())), cc.delayTime(Utils_1.default._FT(3)), cc.spawn(cc.moveTo(Utils_1.default._FT(3), cc.v2(nodePos.x, nodePos.y)).easing(cc.easeSineInOut()), 
                // cc.scaleTo(Utils._FT(10),0.3).easing(cc.easeSineInOut())
                // cc.fadeOut(Utils._FT(5))
                cc.fadeTo(Utils_1.default._FT(3), 85)), cc.callFunc(function () {
                    _this.tempItem.opacity = 0;
                    _this.tempItem.zIndex = 999;
                    // this._inMerge = false;
                    targetCb && targetCb();
                })));
                // this.tempItem.runAction(cc.sequence(
                //     cc.spawn(cc.scaleTo(Utils._FT(3),mScale * 1.8),cc.fadeTo(Utils._FT(3),200),cc.moveTo(Utils._FT(3),nodePos)),
                //     cc.scaleTo(Utils._FT(3),mScale * 0.90),
                //     cc.callFunc(()=>{
                //         this.tempItem.zIndex = -10;
                //     }),
                //     cc.scaleTo(Utils._FT(2),mScale * 1.35),
                //     cc.scaleTo(Utils._FT(2),mScale * 0.9),
                //     cc.scaleTo(Utils._FT(3),mScale),
                //     cc.scaleTo(Utils._FT(3),0).easing(cc.easeSineIn()), cc.callFunc(() => {
                //         this.tempItem.opacity = 0;
                //         this.tempItem.zIndex = 999;
                //         targetCb && targetCb();
                //     })
                // ));
                // this.tempItem.runAction(cc.sequence(cc.scaleTo(0.2, 0).easing(cc.easeSineIn()), cc.callFunc(() => {
                //     this.tempItem.opacity = 0;
                // })))
            }
        }
        this.canDrag = false;
    };
    DragManager.prototype.setDragSkin = function (skin, pos) {
        if (cc.isValid(this.tempItem)) {
            this.tempItem.getComponent(cc.Sprite).spriteFrame = skin;
            this.tempItem.x = pos.x;
            this.tempItem.y = pos.y;
        }
    };
    DragManager.prototype.createTempItem = function () {
        var mIndex = this.dragData["index"];
        if (this.tempItemList[mIndex]) {
            this.tempItem = this.tempItemList[mIndex];
            return;
        }
        if (cc.isValid(this.tempItem)) {
            return this.tempItem;
        }
        this.tempItem = new cc.Node();
        this.tempItem.addComponent(cc.Sprite);
        this.tempItem.parent = this.stage;
        this.tempItemList[mIndex] = this.tempItem;
    };
    DragManager.prototype.getTempItemWorldPos = function () {
        if (!this.tempItem) {
            return cc.v2();
        }
        return this.tempItem.getParent().convertToWorldSpaceAR(this.tempItem.getPosition());
    };
    //获得拖拽对象的数据
    DragManager.prototype.getDragData = function () {
        return this.dragData;
    };
    return DragManager;
}());
exports.default = DragManager.instance();

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zcmMvZnJhbWV3b3JrL21hbmFnZXIvRHJhZ01hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxrREFBNkM7QUFDN0MsNENBQXVDO0FBQ3ZDLHdDQUFtQztBQUVuQyxPQUFPO0FBQ1A7SUFBQTtRQUNZLGlCQUFZLEdBQVcsY0FBYyxDQUFDO1FBQ3RDLGFBQVEsR0FBWSxJQUFJLENBQUM7UUFDekIsVUFBSyxHQUFZLElBQUksQ0FBQztRQUN0QixnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUM3QixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGtCQUFhLEdBQVksSUFBSSxDQUFDO1FBQzlCLGVBQVUsR0FBWSxJQUFJLENBQUM7UUFDM0IsaUJBQVksR0FBWSxJQUFJLENBQUM7UUFDN0IsWUFBTyxHQUFZLElBQUksQ0FBQztRQUN4QixXQUFNLEdBQVksS0FBSyxDQUFDO1FBR3pCLGFBQVEsR0FBYSxLQUFLLENBQUM7UUFDMUIsaUJBQVksR0FBUyxFQUFFLENBQUM7SUF5TXBDLENBQUM7SUFyTVUsb0JBQVEsR0FBZjtRQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztTQUN0QztRQUNELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUMxQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsK0JBQVMsR0FBVCxVQUFVLE1BQWUsRUFBRSxPQUFPO1FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDekMsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUM7WUFDcEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDbkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7U0FDMUI7SUFDTCxDQUFD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Q1gsaUNBQVcsR0FBWDtRQUNJLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN6QixDQUFDO0lBQ0wsa0JBQUM7QUFBRCxDQXZOQSxBQXVOQyxJQUFBO0FBRUQsa0JBQWUsV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDIiwiZmlsZSI6IiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEdsb2JhbCBmcm9tIFwiLi4vLi4vZ2FtZS9jb25zdHMvR2xvYmFsXCI7XHJcbmltcG9ydCBIYW5kbGVyIGZyb20gXCIuLi9iYXNlL0hhbmRsZXJcIjtcclxuaW1wb3J0IE5SZXNwb25lciBmcm9tIFwiLi4vbWVzc2FnZS9OUmVzcG9uZXJcIjtcclxuaW1wb3J0IE1LVXRpbHMgZnJvbSBcIi4uL3Rvb2xzL01rVXRpbHNcIjtcclxuaW1wb3J0IFV0aWxzIGZyb20gXCIuLi90b29scy9VdGlsc1wiO1xyXG5cclxuLy/mi5bmi73nrqHnkIbnsbtcclxuY2xhc3MgRHJhZ01hbmFnZXIge1xyXG4gICAgcHJpdmF0ZSBCYXNlRHJvcE5hbWU6IHN0cmluZyA9ICdCYXNlRHJvcEl0ZW0nO1xyXG4gICAgcHJpdmF0ZSB0ZW1wSXRlbTogY2MuTm9kZSA9IG51bGw7XHJcbiAgICBwcml2YXRlIHN0YWdlOiBjYy5Ob2RlID0gbnVsbDtcclxuICAgIHByaXZhdGUgaXNJbml0RXZlbnQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgZHJhZ0RhdGEgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVIYW5kbGVyOiBIYW5kbGVyID0gbnVsbDtcclxuICAgIHByaXZhdGUgZW5kSGFuZGxlcjogSGFuZGxlciA9IG51bGw7XHJcbiAgICBwcml2YXRlIHN0YXJ0SGFuZGxlcjogSGFuZGxlciA9IG51bGw7XHJcbiAgICBwcml2YXRlIGNhbkRyYWc6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBpc0luaXQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgdGhpc09iajogYW55O1xyXG4gICAgcHJpdmF0ZSBpbml0UG9zOiBhbnk7Ly/liJ3lp4vkvY3nva5cclxuICAgIHB1YmxpYyBfaW5NZXJnZSA6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgdGVtcEl0ZW1MaXN0IDogYW55ID0ge307XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgX2luc3RhbmNlOiBEcmFnTWFuYWdlcjtcclxuXHJcbiAgICBzdGF0aWMgaW5zdGFuY2UoKTogRHJhZ01hbmFnZXIge1xyXG4gICAgICAgIGlmICghdGhpcy5faW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5faW5zdGFuY2UgPSBuZXcgRHJhZ01hbmFnZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yid5aeL5YyW6aG257qnXHJcbiAgICAgKiBAcGFyYW0gc2NyZWVuIFxyXG4gICAgICovXHJcbiAgICBpbml0U3RhZ2Uoc2NyZWVuOiBjYy5Ob2RlLCB0aGlzT2JqKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzSW5pdCAmJiAhY2MuaXNWYWxpZCh0aGlzLnN0YWdlKSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YWdlID0gc2NyZWVuO1xyXG4gICAgICAgICAgICB0aGlzLmlzSW5pdCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMudGhpc09iaiA9IHRoaXNPYmo7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8v5byA5aeL5ouW5Yqo5Yqo55S7XHJcbiAgICBzdGFydERyYWdIYW5kbGVyKHNwcml0ZUZyYW1lLCBwb3MsIGRyYWdEYXRhKSB7XHJcbiAgICAgICAgdGhpcy5pbml0UG9zID0gcG9zO1xyXG4gICAgICAgIHRoaXMuZHJhZ0RhdGEgPSBkcmFnRGF0YTtcclxuICAgICAgICB0aGlzLmluaXRTdGFnZUV2ZW50KCk7XHJcbiAgICAgICAgaWYgKGNjLmlzVmFsaWQoc3ByaXRlRnJhbWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RHJhZ1NraW4oc3ByaXRlRnJhbWUsIHBvcyk7XHJcbiAgICAgICAgICAgIHRoaXMudGVtcEl0ZW0ub3BhY2l0eSA9IDI1NTtcclxuICAgICAgICAgICAgdGhpcy50ZW1wSXRlbS5zZXRTY2FsZShkcmFnRGF0YS5tb3ZlVGFyZ2V0LnNjYWxlKVxyXG4gICAgICAgICAgICB0aGlzLnRlbXBJdGVtLnN0b3BBbGxBY3Rpb25zKCk7XHJcbiAgICAgICAgICAgIGxldCBzYyA9IGRyYWdEYXRhLm1vdmVUYXJnZXQuc2NhbGU7XHJcbiAgICAgICAgICAgIHRoaXMudGVtcEl0ZW0ucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLnNjYWxlVG8oMC4yLCBzYyArIDAuMiksXHJcbiAgICAgICAgICAgICAgICBjYy5zY2FsZVRvKDAuMiwgc2MpKSlcclxuICAgICAgICAgICAgdGhpcy5jYW5EcmFnID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNhbkRyYWcgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdGFydEhhbmRsZXIgJiYgdGhpcy5zdGFydEhhbmRsZXIuY2FsbCh0aGlzLnRoaXNPYmosIHRoaXMuZHJhZ0RhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8v6K6+572u5Zue6LCD5Ye95pWwXHJcbiAgICAvL3VwZGF0ZUhhbmRsZXIg5pu05paw5Ye95pWwXHJcbiAgICAvL+i/lOWbnuaXtuWbnuiwg1xyXG4gICAgc2V0Q2FsbEJhY2tIYW5kbGVyKHVwZGF0ZUhhbmRsZXIsIGVuZEhhbmRsZXIsIHN0YXJ0SGFuZGxlcikge1xyXG4gICAgICAgIHRoaXMudXBkYXRlSGFuZGxlciA9IHVwZGF0ZUhhbmRsZXI7XHJcbiAgICAgICAgdGhpcy5lbmRIYW5kbGVyID0gZW5kSGFuZGxlcjtcclxuICAgICAgICB0aGlzLnN0YXJ0SGFuZGxlciA9IHN0YXJ0SGFuZGxlcjtcclxuICAgIH1cclxuXHJcbiAgICAvL+aLluaUvuaYr+WQpuaIkOWKn+eahOWbnuiwg1xyXG4gICAgZHJhZ1N1Y2Nlc3Moc3RhdGUpIHtcclxuICAgICAgICBOUmVzcG9uZXIuZGlzcGF0Y2goJ2RyYWdTdGF0dXMnLCBzdGF0ZSwgdGhpcy5kcmFnRGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0U3RhZ2VFdmVudCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNJbml0RXZlbnQgJiYgY2MuaXNWYWxpZCh0aGlzLnN0YWdlKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVRlbXBJdGVtKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaXNJbml0RXZlbnQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLnN0YWdlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIHRoaXMubW92ZVRvdWNoSGFuZGxlciwgdGhpcywgZmFsc2UpO1xyXG4gICAgICAgICAgICAvL+WPlua2iFxyXG4gICAgICAgICAgICB0aGlzLnN0YWdlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0NBTkNFTCwgdGhpcy5jYW5jZWxUb3VjaEhhbmRsZXIsIHRoaXMsIGZhbHNlKTtcclxuICAgICAgICAgICAgLy/pvKDmoIflvLnotbdcclxuICAgICAgICAgICAgdGhpcy5zdGFnZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQsIHRoaXMuZW5kVG91Y2hIYW5kbGVyLCB0aGlzLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbW92ZVRvdWNoSGFuZGxlcihldmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNhbkRyYWcpIHtcclxuICAgICAgICAgICAgLy8gdGhpcy50ZW1wSXRlbS54ID0gZXZlbnQuZ2V0TG9jYXRpb25YKCkgLSA2NDA7XHJcbiAgICAgICAgICAgIC8vIHRoaXMudGVtcEl0ZW0ueSA9IGV2ZW50LmdldExvY2F0aW9uWSgpIC0gMzYwO1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBJdGVtLnNldFBvc2l0aW9uKHRoaXMuc3RhZ2UuY29udmVydFRvTm9kZVNwYWNlQVIoZXZlbnQuZ2V0TG9jYXRpb24oKSkpO1xyXG4gICAgICAgICAgICBpZiAoISF0aGlzLnVwZGF0ZUhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSGFuZGxlci5jYWxsKHRoaXMudGhpc09iaiwgdGhpcy50ZW1wSXRlbSwgdGhpcy5kcmFnRGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjYW5jZWxUb3VjaEhhbmRsZXIoZXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5jYW5EcmFnKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMucmVtb3ZlU3RhZ2VFdmVudChldmVudC5nZXRMb2NhdGlvbigpKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZW5kSGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbmRIYW5kbGVyLmNhbGwodGhpcy50aGlzT2JqLCB0aGlzLnRlbXBJdGVtLCB0aGlzLmRyYWdEYXRhLCBldmVudC5nZXRMb2NhdGlvbigpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGVuZFRvdWNoSGFuZGxlcihldmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNhbkRyYWcpIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5yZW1vdmVTdGFnZUV2ZW50KGV2ZW50LmdldExvY2F0aW9uKCkpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lbmRIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVuZEhhbmRsZXIuY2FsbCh0aGlzLnRoaXNPYmosIHRoaXMudGVtcEl0ZW0sIHRoaXMuZHJhZ0RhdGEsIGV2ZW50LmdldExvY2F0aW9uKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVtb3ZlU3RhZ2VFdmVudChwb3M/LGNhbGxCYWNrPyx0YXJnZXRQb3M/LHRhcmdldENiPyxtU2NhbGU/KSB7XHJcbiAgICAgICAgdGhpcy5pc0luaXRFdmVudCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc3RhZ2Uub2ZmKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIHRoaXMubW92ZVRvdWNoSGFuZGxlciwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5zdGFnZS5vZmYoY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELCB0aGlzLmVuZFRvdWNoSGFuZGxlciwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5zdGFnZS5vZmYoY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfQ0FOQ0VMLCB0aGlzLmNhbmNlbFRvdWNoSGFuZGxlciwgdGhpcyk7XHJcbiAgICAgICAgaWYgKGNjLmlzVmFsaWQodGhpcy50ZW1wSXRlbSkpIHtcclxuICAgICAgICAgICAgbGV0IGRpcyA9IDA7XHJcbiAgICAgICAgICAgIC8vIGxldCBkaXMgPSBHbG9iYWwuSEFORExFX0ZFRUxfQU5JTUFMX0NPTExJU0lPTl9ESVM7XHJcbiAgICAgICAgICAgIGlmKG1TY2FsZSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRlbXBJdGVtLnNjYWxlID0gbVNjYWxlO1xyXG4gICAgICAgICAgICAgICAgZGlzICo9IG1TY2FsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihwb3Mpe1xyXG4gICAgICAgICAgICAgICAgbGV0IGRpcyA9IE1LVXRpbHMudHdvUG9pbnREaXN0YW5jZSh0aGlzLmluaXRQb3MsIHRoaXMuc3RhZ2UuY29udmVydFRvTm9kZVNwYWNlQVIocG9zKSk7XHJcbiAgICAgICAgICAgICAgICAvLyBjYy5sb2coXCJkaXN0YW5jZVwiLGRpcylcclxuICAgICAgICAgICAgICAgIGxldCBkZWxheVRpbWUgPSBkaXMvMjAwMDtcclxuICAgICAgICAgICAgICAgIHRoaXMudGVtcEl0ZW0ucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLm1vdmVUbyhkZWxheVRpbWUsIHRoaXMuaW5pdFBvcykuZWFzaW5nKGNjLmVhc2VTaW5lSW4oKSksIGNjLmNhbGxGdW5jKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbEJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbEJhY2suY2FsbCh0aGlzLnRoaXNPYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBJdGVtLm9wYWNpdHkgPSAwO1xyXG4gICAgICAgICAgICAgICAgfSkpKVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuX2luTWVyZ2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IG1TY2FsZSA9IHRoaXMudGVtcEl0ZW0uc2NhbGU7XHJcbiAgICAgICAgICAgICAgICBsZXQgbm9kZVBvcyA9IHRoaXMudGVtcEl0ZW0uZ2V0UGFyZW50KCkuY29udmVydFRvTm9kZVNwYWNlQVIodGFyZ2V0UG9zKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGVtcEl0ZW0uc2V0UG9zaXRpb24obm9kZVBvcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRlbXBJdGVtLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShcclxuICAgICAgICAgICAgICAgICAgICBjYy5zY2FsZVRvKFV0aWxzLl9GVCgzKSwwLjMpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNjLnNwYXduKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5tb3ZlVG8oVXRpbHMuX0ZUKDUpLGNjLnYyKG5vZGVQb3MueCArIGRpcyxub2RlUG9zLnkpKS5lYXNpbmcoY2MuZWFzZVNpbmVJbk91dCgpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2Muc2NhbGVUbyhVdGlscy5fRlQoNSksbVNjYWxlICxtU2NhbGUpLmVhc2luZyhjYy5lYXNlU2luZUluT3V0KCkpKSxcclxuICAgICAgICAgICAgICAgICAgICBjYy5kZWxheVRpbWUoVXRpbHMuX0ZUKDMpKSxcclxuICAgICAgICAgICAgICAgICAgICBjYy5zcGF3bihcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2MubW92ZVRvKFV0aWxzLl9GVCgzKSxjYy52Mihub2RlUG9zLngsbm9kZVBvcy55KSkuZWFzaW5nKGNjLmVhc2VTaW5lSW5PdXQoKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNjLnNjYWxlVG8oVXRpbHMuX0ZUKDEwKSwwLjMpLmVhc2luZyhjYy5lYXNlU2luZUluT3V0KCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNjLmZhZGVPdXQoVXRpbHMuX0ZUKDUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5mYWRlVG8oVXRpbHMuX0ZUKDMpLDg1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgICAgIGNjLmNhbGxGdW5jKCgpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcEl0ZW0ub3BhY2l0eSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcEl0ZW0uekluZGV4ID0gOTk5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLl9pbk1lcmdlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldENiICYmIHRhcmdldENiKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICkpO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy50ZW1wSXRlbS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY2Muc3Bhd24oY2Muc2NhbGVUbyhVdGlscy5fRlQoMyksbVNjYWxlICogMS44KSxjYy5mYWRlVG8oVXRpbHMuX0ZUKDMpLDIwMCksY2MubW92ZVRvKFV0aWxzLl9GVCgzKSxub2RlUG9zKSksXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY2Muc2NhbGVUbyhVdGlscy5fRlQoMyksbVNjYWxlICogMC45MCksXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY2MuY2FsbEZ1bmMoKCk9PntcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy50ZW1wSXRlbS56SW5kZXggPSAtMTA7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgfSksXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY2Muc2NhbGVUbyhVdGlscy5fRlQoMiksbVNjYWxlICogMS4zNSksXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY2Muc2NhbGVUbyhVdGlscy5fRlQoMiksbVNjYWxlICogMC45KSxcclxuICAgICAgICAgICAgICAgIC8vICAgICBjYy5zY2FsZVRvKFV0aWxzLl9GVCgzKSxtU2NhbGUpLFxyXG4gICAgICAgICAgICAgICAgLy8gICAgIGNjLnNjYWxlVG8oVXRpbHMuX0ZUKDMpLDApLmVhc2luZyhjYy5lYXNlU2luZUluKCkpLCBjYy5jYWxsRnVuYygoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHRoaXMudGVtcEl0ZW0ub3BhY2l0eSA9IDA7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHRoaXMudGVtcEl0ZW0uekluZGV4ID0gOTk5O1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICB0YXJnZXRDYiAmJiB0YXJnZXRDYigpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIH0pXHJcbiAgICAgICAgICAgICAgICAvLyApKTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMudGVtcEl0ZW0ucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLnNjYWxlVG8oMC4yLCAwKS5lYXNpbmcoY2MuZWFzZVNpbmVJbigpKSwgY2MuY2FsbEZ1bmMoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIHRoaXMudGVtcEl0ZW0ub3BhY2l0eSA9IDA7XHJcbiAgICAgICAgICAgICAgICAvLyB9KSkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jYW5EcmFnID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXREcmFnU2tpbihza2luLCBwb3MpIHtcclxuICAgICAgICBpZiAoY2MuaXNWYWxpZCh0aGlzLnRlbXBJdGVtKSkge1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBJdGVtLmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNwcml0ZUZyYW1lID0gc2tpbjtcclxuICAgICAgICAgICAgdGhpcy50ZW1wSXRlbS54ID0gcG9zLng7XHJcbiAgICAgICAgICAgIHRoaXMudGVtcEl0ZW0ueSA9IHBvcy55O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVRlbXBJdGVtKCkge1xyXG4gICAgICAgIGxldCBtSW5kZXggPSB0aGlzLmRyYWdEYXRhW1wiaW5kZXhcIl07XHJcbiAgICAgICAgaWYodGhpcy50ZW1wSXRlbUxpc3RbbUluZGV4XSl7XHJcbiAgICAgICAgICAgIHRoaXMudGVtcEl0ZW0gPSB0aGlzLnRlbXBJdGVtTGlzdFttSW5kZXhdO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjYy5pc1ZhbGlkKHRoaXMudGVtcEl0ZW0pKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRlbXBJdGVtO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRlbXBJdGVtID0gbmV3IGNjLk5vZGUoKTtcclxuICAgICAgICB0aGlzLnRlbXBJdGVtLmFkZENvbXBvbmVudChjYy5TcHJpdGUpO1xyXG4gICAgICAgIHRoaXMudGVtcEl0ZW0ucGFyZW50ID0gdGhpcy5zdGFnZTtcclxuICAgICAgICB0aGlzLnRlbXBJdGVtTGlzdFttSW5kZXhdID0gdGhpcy50ZW1wSXRlbTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBnZXRUZW1wSXRlbVdvcmxkUG9zKCl7XHJcbiAgICAgICAgaWYoIXRoaXMudGVtcEl0ZW0pe1xyXG4gICAgICAgICAgICByZXR1cm4gY2MudjIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudGVtcEl0ZW0uZ2V0UGFyZW50KCkuY29udmVydFRvV29ybGRTcGFjZUFSKHRoaXMudGVtcEl0ZW0uZ2V0UG9zaXRpb24oKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy/ojrflvpfmi5bmi73lr7nosaHnmoTmlbDmja5cclxuICAgIGdldERyYWdEYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRyYWdEYXRhO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBEcmFnTWFuYWdlci5pbnN0YW5jZSgpOyJdfQ==